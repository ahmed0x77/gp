(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{80022:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return r(41639)}])},41639:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return eY},default:function(){return eB}});var a,s,l,n,o=r(85893),i=r(97283),d=r(63072),c=r(37096),u=r(67294);let x=e=>{let{size:t="1em",className:r=""}=e;return(0,o.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(r),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,o.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,o.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,o.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,o.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,o.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,o.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,o.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var m=r(94568),p=r(21223),h=r(23461);(s||(s={})).GOOGLE_SEARCH="google-search",(l||(l={})).GOOGLE_SEARCH="Google Search";let g={[s.GOOGLE_SEARCH]:{id:s.GOOGLE_SEARCH,name:l.GOOGLE_SEARCH,requiredKeys:[{key:"GOOGLE_API_KEY",value:""},{key:"GOOGLE_CSE_ID",value:""}]}},f=Object.values(g),v=e=>{let{plugin:t,onPluginChange:r}=e,{t:a}=(0,c.$G)("chat"),s=(0,u.useRef)(null);return(0,u.useEffect)(()=>{s.current&&s.current.focus()},[]),(0,o.jsx)("div",{className:"flex flex-col",children:(0,o.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,o.jsxs)("select",{ref:s,className:"w-full cursor-pointer bg-transparent p-2",placeholder:a("Select a plugin")||"",value:(null==t?void 0:t.id)||"",onChange:e=>{r(f.find(t=>t.id===e.target.value))},children:[(0,o.jsx)("option",{value:"",className:"dark:bg-[#343541] dark:text-white",children:"Select Plugin"},"none"),f.map(e=>(0,o.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.name},e.id))]})})})},b=e=>{let{prompts:t,activePromptIndex:r,onSelect:a,onMouseOver:s,promptListRef:l}=e;return(0,o.jsx)("ul",{ref:l,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,o.jsx)("li",{className:"".concat(t===r?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),a()},onMouseEnter:()=>s(t),children:e.name},e.id))})},y=e=>{let{prompt:t,variables:r,onSubmit:a,onClose:s}=e,[l,n]=(0,u.useState)(r.map(e=>({key:e,value:""})).filter((e,t,r)=>r.findIndex(t=>t.key===e.key)===t)),i=(0,u.useRef)(null),d=(0,u.useRef)(null),c=(e,t)=>{n(r=>{let a=[...r];return a[e].value=t,a})},x=()=>{if(l.some(e=>""===e.value)){alert("Please fill out all variables");return}a(l.map(e=>e.value)),s()},m=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&s():(e.preventDefault(),x())};return(0,u.useEffect)(()=>{let e=e=>{i.current&&!i.current.contains(e.target)&&s()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[s]),(0,u.useEffect)(()=>{d.current&&d.current.focus()},[]),(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:m,children:(0,o.jsxs)("div",{ref:i,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-hidden overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,o.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),l.map((e,t)=>(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,o.jsx)("textarea",{ref:0===t?d:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>c(t,e.target.value),rows:3})]},t)),(0,o.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:x,children:"Submit"})]})})},w=e=>{var t;let{messageIsStreaming:r,model:a,conversationIsEmpty:s,prompts:l,onSend:n,onRegenerate:i,stopConversationRef:d,textareaRef:x}=e,{t:g}=(0,c.$G)("chat"),[f,w]=(0,u.useState)(),[j,k]=(0,u.useState)(!1),[N,S]=(0,u.useState)(!1),[C,I]=(0,u.useState)(0),[E,P]=(0,u.useState)(""),[O,D]=(0,u.useState)([]),[z,Z]=(0,u.useState)(!1),[T,L]=(0,u.useState)(!1),[_,G]=(0,u.useState)(null),A=(0,u.useRef)(null),K=l.filter(e=>e.name.toLowerCase().includes(E.toLowerCase())),R=e=>{let t=e.target.value,r=a.maxLength;if(t.length>r){alert(g("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}w(t),W(t)},F=()=>{if(!r){if(!f){alert(g("Please enter a message"));return}n({role:"user",content:f},_),w(""),G(null),window.innerWidth<640&&x&&x.current&&x.current.blur()}},U=()=>{d.current=!0,setTimeout(()=>{d.current=!1},1e3)},J=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},M=()=>{let e=K[C];e&&(w(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),Y(e)),S(!1)},H=e=>{N?"ArrowDown"===e.key?(e.preventDefault(),I(e=>e<l.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),I(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),I(e=>e<l.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),M()):"Escape"===e.key?(e.preventDefault(),S(!1)):I(0):"Enter"!==e.key||j||J()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),L(!T)):(e.preventDefault(),F())},$=e=>{let t;let r=/{{(.*?)}}/g,a=[];for(;null!==(t=r.exec(e));)a.push(t[1]);return a},W=(0,u.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(S(!0),P(t[0].slice(1))):(S(!1),P(""))},[]),Y=e=>{let t=$(e.content);D(t),t.length>0?Z(!0):(w(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),W(e.content))},B=e=>{let t=null==f?void 0:f.replace(/{{(.*?)}}/g,(t,r)=>{let a=O.indexOf(r);return e[a]});w(t),x&&x.current&&x.current.focus()};return(0,u.useEffect)(()=>{A.current&&(A.current.scrollTop=30*C)},[C]),(0,u.useEffect)(()=>{if(x&&x.current){var e,t;x.current.style.height="inherit",x.current.style.height="".concat(null===(e=x.current)||void 0===e?void 0:e.scrollHeight,"px"),x.current.style.overflow="".concat((null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[f]),(0,u.useEffect)(()=>{let e=e=>{A.current&&!A.current.contains(e.target)&&S(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,o.jsxs)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:[(0,o.jsxs)("div",{className:"stretch mx-2 mt-4 flex flex-row gap-3 last:mb-2 md:mx-4 md:mt-[52px] md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:[r&&(0,o.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:U,children:[(0,o.jsx)(m.Z,{size:16})," ",g("Stop Generating")]}),!r&&!s&&(0,o.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:i,children:[(0,o.jsx)(p.Z,{size:16})," ",g("Regenerate response")]}),(0,o.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[T&&(0,o.jsx)("div",{className:"absolute left-0 bottom-14 bg-white dark:bg-[#343541]",children:(0,o.jsx)(v,{plugin:_,onPluginChange:e=>{G(e),L(!1),x&&x.current&&x.current.focus()}})}),(0,o.jsx)("textarea",{ref:x,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-3.5 text-black dark:bg-transparent dark:text-white md:py-3",style:{resize:"none",bottom:"".concat(null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(x.current&&x.current.scrollHeight>400?"auto":"hidden")},placeholder:g('Type a message or type "/" to select a prompt...')||"",value:f,rows:1,onCompositionStart:()=>k(!0),onCompositionEnd:()=>k(!1),onChange:R,onKeyDown:H}),(0,o.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:F,children:r?(0,o.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,o.jsx)(h.Z,{size:18})}),N&&K.length>0&&(0,o.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,o.jsx)(b,{activePromptIndex:C,prompts:K,onSelect:M,onMouseOver:I,promptListRef:A})}),z&&(0,o.jsx)(y,{prompt:l[C],variables:O,onSubmit:B,onClose:()=>Z(!1)})]})]}),(0,o.jsx)("div",{className:"px-3 pt-2 pb-3 text-center text-[12px] text-black/50 dark:text-white/50 md:px-4 md:pt-3 md:pb-6",children:g("Refresh the page if response is frozen. NextChat.ai may produce inaccurate responses.")})]})};var j=r(10614);let k=()=>(0,o.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,o.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"AI:"}),(0,o.jsx)(j.Z,{className:"animate-pulse"})]})});var N=r(90553),S=r(8861),C=r(21942),I=r(88198),E=r(93625),P=r(45884),O=r(29758),D=r(30399);let z={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="ABCDEFGHJKLMNPQRSTUVWXY3456789",a="";for(let t=0;t<e;t++)a+=r.charAt(Math.floor(Math.random()*r.length));return t?a.toLowerCase():a};var T=r(67828),L=r(80335),_=r(93179),G=r(84283);let A=(0,u.memo)(e=>{let{language:t,value:r}=e,{t:a}=(0,c.$G)("markdown"),[s,l]=(0,u.useState)(!1),n=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(r).then(()=>{l(!0),setTimeout(()=>{l(!1)},2e3)})},i=()=>{let e=z[t]||".file",s="file-".concat(Z(3,!0)).concat(e),l=window.prompt(a("Enter file name")||"",s);if(!l)return;let n=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=l,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,o.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,o.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:n,children:[s?(0,o.jsx)(I.Z,{size:18}):(0,o.jsx)(T.Z,{size:18}),s?a("Copied!"):a("Copy code")]}),(0,o.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:i,children:(0,o.jsx)(L.Z,{size:18})})]})]}),(0,o.jsx)(_.Z,{language:t,style:G.vk,customStyle:{margin:0},children:r})]})});A.displayName="CodeBlock";var K=r(16202);let R=(0,u.memo)(K.D),F=(0,u.memo)(e=>{let{message:t,messageIndex:r,onEditMessage:a}=e,{t:s}=(0,c.$G)("chat"),[l,n]=(0,u.useState)(!1),[i,d]=(0,u.useState)(!1),[x,m]=(0,u.useState)(t.content),[p,h]=(0,u.useState)(!1),g=(0,u.useRef)(null),f=()=>{n(!l)},v=e=>{m(e.target.value),g.current&&(g.current.style.height="inherit",g.current.style.height="".concat(g.current.scrollHeight,"px"))},b=()=>{t.content!=x&&a({...t,content:x},r),n(!1)},y=e=>{"Enter"!==e.key||i||e.shiftKey||(e.preventDefault(),b())},w=()=>{navigator.clipboard&&navigator.clipboard.writeText(t.content).then(()=>{h(!0),setTimeout(()=>{h(!1)},2e3)})};return(0,u.useEffect)(()=>{g.current&&(g.current.style.height="inherit",g.current.style.height="".concat(g.current.scrollHeight,"px"))},[l]),(0,o.jsx)("div",{className:"group px-4 ".concat("assistant"===t.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"relative m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,o.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===t.role?(0,o.jsx)(N.Z,{size:30}):(0,o.jsx)(S.Z,{size:30})}),(0,o.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===t.role?(0,o.jsxs)("div",{className:"flex w-full",children:[l?(0,o.jsxs)("div",{className:"flex w-full flex-col",children:[(0,o.jsx)("textarea",{ref:g,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:x,onChange:v,onKeyDown:y,onCompositionStart:()=>d(!0),onCompositionEnd:()=>d(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,o.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,o.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:b,disabled:x.trim().length<=0,children:s("Save & Submit")}),(0,o.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{m(t.content),n(!1)},children:s("Cancel")})]})]}):(0,o.jsx)("div",{className:"prose whitespace-pre-wrap dark:prose-invert",children:t.content}),(window.innerWidth<640||!l)&&(0,o.jsx)("button",{className:"absolute translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300 ".concat(window.innerWidth<640?"bottom-1 right-3":"right-0 top-[26px]","\n                    "),onClick:f,children:(0,o.jsx)(C.Z,{size:20})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"absolute ".concat(window.innerWidth<640?"bottom-1 right-3":"right-0 top-[26px] m-0"),children:p?(0,o.jsx)(I.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,o.jsx)("button",{className:"translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300",onClick:w,children:(0,o.jsx)(E.Z,{size:20})})}),(0,o.jsx)(R,{className:"prose dark:prose-invert",remarkPlugins:[O.Z,D.Z],rehypePlugins:[P.Z],components:{code(e){let{node:t,inline:r,className:a,children:s,...l}=e,n=/language-(\w+)/.exec(a||"");return r?(0,o.jsx)("code",{className:a,...l,children:s}):(0,o.jsx)(A,{language:n&&n[1]||"",value:String(s).replace(/\n$/,""),...l},Math.random())},table(e){let{children:t}=e;return(0,o.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,o.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,o.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:t.content})]})})]})})});F.displayName="ChatMessage";var U=r(58403);let J=e=>{let{error:t}=e;return(0,o.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,o.jsx)("div",{className:"mb-5",children:(0,o.jsx)(U.Z,{size:36})}),(0,o.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,o.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,o.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,o.jsxs)("i",{children:["Code: ",t.code]}):""})]})};var M=r(41664),H=r.n(M),$=r(33299),W=r(72052);let Y=(0,u.memo)(e=>{var t;let r,a,{conversation:s,models:l,apiKey:n,serverSideApiKeyIsSet:m,defaultModelId:p,messageIsStreaming:h,modelError:g,loading:f,prompts:v,onSend:b,onUpdateConversation:y,onEditMessage:j,stopConversationRef:N}=e,{t:S}=(0,c.$G)("chat"),[C,I]=(0,u.useState)(),[E,P]=(0,u.useState)(!0),[O,D]=(0,u.useState)(!1),[z,Z]=(0,u.useState)(!1),T=(0,u.useRef)(null),L=(0,u.useRef)(null),_=(0,u.useRef)(null);(0,u.useCallback)(()=>{if(E){var e,t;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=_.current)||void 0===t||t.focus()}},[E]);let G=()=>{if(L.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=L.current;e+r<t-30?(P(!1),Z(!0)):(P(!0),Z(!1))}},A=()=>{var e;null===(e=L.current)||void 0===e||e.scrollTo({top:L.current.scrollHeight,behavior:"smooth"})},K=()=>{confirm(S("Are you sure you want to clear all messages?"))&&y(s,{key:"messages",value:[]})},R=()=>{if(E){var e;null===(e=T.current)||void 0===e||e.scrollIntoView(!0)}},U=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];a?(clearTimeout(r),r=setTimeout(()=>{Date.now()-a>=250&&(R(...t),a=Date.now())},250-(Date.now()-a))):(R(...t),a=Date.now())},M=async e=>{try{let r=await fetch("/api/stripe-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await r.json();if(r.ok&&a)console.log(a),alert(a.message),(0,$.signOut)();else{var t;console.error("Error creating subscription:",null!==(t=null==a?void 0:a.message)&&void 0!==t?t:r.statusText),alert("Error creating subscription. Please try again later.")}}catch(e){console.error("Error creating subscription:",e),alert("Error creating subscription. Please try again later.")}};(0,u.useEffect)(()=>{U(),I(s.messages[s.messages.length-2])},[s.messages,U]),(0,u.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(P(t.isIntersecting),t.isIntersecting){var r;null===(r=_.current)||void 0===r||r.focus()}},{root:null,threshold:.5}),t=T.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[T]);let Y=(0,$.useSession)();return Y.data&&Y.data.user.dateCreated&&"free"===Y.data.user.membership&&new Date().getTime()-new Date(Y.data.user.dateCreated).getTime()>2592e5?(0,o.jsx)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:(0,o.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"You have reached your free trial limit for NextChat.ai"}),(0,o.jsxs)("div",{className:"text-center text-lg text-black dark:text-white",children:[(0,o.jsx)("p",{className:"mb-4",children:"To continue using NextChat.ai, upgrade your account to NextChat Plus for $20/month."}),(0,o.jsx)("p",{className:"mb-4",children:"Once you upgrade to NextChat Plus, you will be able to use NextChat.ai without any further limitations."}),(0,o.jsx)("p",{children:'Click the "Go Plus" button below to Go Plus:'}),(0,o.jsx)("div",{className:"w-full flex justify-center mt-6",children:(0,o.jsx)(W.Z,{name:"NextChat Plus",description:"USD $20/mo",panelLabel:"Go Plus",email:null!==(t=Y.data.user.email)&&void 0!==t?t:"",currency:"USD",locale:"auto",stripeKey:"pk_live_9o7xarrQQSR8yfoIwh5r2uIk00yFNr81db",token:M,children:(0,o.jsx)("button",{className:"cursor-pointer flex justify-center items-center rounded-md py-2 px-12 text-[18px] font-semibold text-white transition-colors duration-200 bg-[#343541] hover:bg-gray-500/80",children:(0,o.jsx)("span",{children:"Go Plus"})})})}),(0,o.jsx)("p",{className:"text-xs mt-2",children:"Cancel anytime"})]})]})}):(0,o.jsxs)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:[n||m?g?(0,o.jsx)(J,{error:g}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:L,onScroll:G,children:0===s.messages.length?(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"mx-auto flex w-[350px] flex-col space-y-10 pt-12 sm:w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:0===l.length?(0,o.jsx)("div",{children:(0,o.jsx)(x,{size:"16px",className:"mx-auto"})}):"NextChat.ai"}),l.length>0&&(0,o.jsx)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:(0,o.jsxs)("p",{className:"text-gray-800 dark:text-gray-100",children:["NextChat.ai keeps your data secure by making it impossible for NextChat.ai to save your conversations or prompts.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Your conversations and prompts are only saved to your local device (laptop, tablet, or phone).",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"We do not save your conversation or prompt data to our database.",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"You can feel safe using personal or company data in your NextChat.ai conversations. That data is not saved by NextChat.ai."]})})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:(0,o.jsxs)("button",{className:"ml-2 cursor-pointer hover:opacity-50 flex items-center border py-2 px-2 rounded bg-white",onClick:K,children:[(0,o.jsx)(i.Z,{size:16})," \xa0 Clear Conversation"]})}),s.messages.map((e,t)=>(0,o.jsx)(F,{message:e,messageIndex:t,onEditMessage:j},t)),f&&(0,o.jsx)(k,{}),(0,o.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:T})]})}),(0,o.jsx)(w,{stopConversationRef:N,textareaRef:_,messageIsStreaming:h,conversationIsEmpty:0===s.messages.length,model:s.model,prompts:v,onSend:(e,t)=>{I(e),b(e,0,t)},onRegenerate:()=>{C&&b(C,2,null)}})]}):(0,o.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to NextChat.ai"}),(0,o.jsxs)("div",{className:"text-center text-lg text-black dark:text-white",children:[(0,o.jsx)("div",{className:"mb-8",children:"NextChat.ai is an open source clone of OpenAI's ChatGPT UI."}),(0,o.jsx)("div",{className:"mb-2 font-bold",children:"Important: NextChat.ai is 100% unaffiliated with OpenAI."})]}),(0,o.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,o.jsx)("div",{className:"mb-2",children:"NextChat.ai allows you to plug in your API key to use this UI with their API."}),(0,o.jsxs)("div",{className:"mb-2",children:["It is ",(0,o.jsx)("span",{className:"italic",children:"only"})," used to communicate with their API."]}),(0,o.jsx)("div",{className:"mb-2",children:S("Please set your OpenAI API key in the bottom left of the sidebar.")}),(0,o.jsxs)("div",{children:[S("If you don't have an OpenAI API key, you can get one here: "),(0,o.jsx)(H(),{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:underline",children:"openai.com"})]})]})]}),z&&(0,o.jsx)("div",{className:"absolute bottom-0 right-0 mb-4 mr-4 pb-20",children:(0,o.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:A,children:(0,o.jsx)(d.Z,{size:18})})})]})});Y.displayName="Chat";var B=r(1177),q=r(16745),Q=r(55814),V=r(87664),X=r(62577),ee=r(30471),et=r(74075),er=r(47447);let ea=e=>{let{selectedConversation:t,conversation:r,loading:a,onSelectConversation:s,onDeleteConversation:l,onUpdateConversation:n}=e,[d,c]=(0,u.useState)(!1),[x,m]=(0,u.useState)(!1),[p,h]=(0,u.useState)(""),g=e=>{"Enter"===e.key&&(e.preventDefault(),v(t))},f=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},v=e=>{p.trim().length>0&&(n(e,{key:"name",value:p}),h(""),m(!1))};return(0,u.useEffect)(()=>{x?c(!1):d&&m(!1)},[x,d]),(0,o.jsxs)("div",{className:"relative flex items-center",children:[x&&t.id===r.id?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3 rounded-lg",children:[(0,o.jsx)(er.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:p,onChange:e=>h(e.target.value),onKeyDown:g,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(a?"disabled:cursor-not-allowed":""," ").concat(t.id===r.id?"bg-[#343541]/90":""),onClick:()=>s(r),disabled:a,draggable:"true",onDragStart:e=>f(e,r),children:[(0,o.jsx)(er.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat(t.id===r.id?"pr-12":"pr-1"),children:r.name})]}),(d||x)&&t.id===r.id&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),d?l(r):x&&v(r),c(!1),m(!1)},children:(0,o.jsx)(I.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),c(!1),m(!1)},children:(0,o.jsx)(i.Z,{size:18})})]}),t.id===r.id&&!d&&!x&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),m(!0),h(t.name)},children:(0,o.jsx)(ee.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),c(!0)},children:(0,o.jsx)(et.Z,{size:18})})]})]})},es=e=>{let{searchTerm:t,conversations:r,currentFolder:a,onDeleteFolder:s,onUpdateFolder:l,selectedConversation:n,loading:d,onSelectConversation:c,onDeleteConversation:x,onUpdateConversation:m}=e,[p,h]=(0,u.useState)(!1),[g,f]=(0,u.useState)(!1),[v,b]=(0,u.useState)(""),[y,w]=(0,u.useState)(!1),j=e=>{"Enter"===e.key&&(e.preventDefault(),k())},k=()=>{l(a.id,v),b(""),f(!1)},N=(e,t)=>{if(e.dataTransfer){w(!0);let r=JSON.parse(e.dataTransfer.getData("conversation"));m(r,{key:"folderId",value:t.id}),e.target.style.background="none"}},S=e=>{e.preventDefault()},C=e=>{e.target.style.background="#343541"},E=e=>{e.target.style.background="none"};return(0,u.useEffect)(()=>{g?h(!1):p&&f(!1)},[g,p]),(0,u.useEffect)(()=>{t?w(!0):w(!1)},[t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"relative flex items-center",children:[g?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3 rounded-lg",children:[y?(0,o.jsx)(V.Z,{size:18}):(0,o.jsx)(X.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:v,onChange:e=>b(e.target.value),onKeyDown:j,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>w(!y),onDrop:e=>N(e,a),onDragOver:S,onDragEnter:C,onDragLeave:E,children:[y?(0,o.jsx)(V.Z,{size:18}):(0,o.jsx)(X.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:a.name})]}),(p||g)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),p?s(a.id):g&&k(),h(!1),f(!1)},children:(0,o.jsx)(I.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),h(!1),f(!1)},children:(0,o.jsx)(i.Z,{size:18})})]}),!p&&!g&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),f(!0),b(a.name)},children:(0,o.jsx)(ee.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),h(!0)},children:(0,o.jsx)(et.Z,{size:18})})]})]}),y?r.map((e,t)=>{if(e.folderId===a.id)return(0,o.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,o.jsx)(ea,{selectedConversation:n,conversation:e,loading:d,onSelectConversation:c,onDeleteConversation:x,onUpdateConversation:m})},t)}):null]})},el=e=>{let{searchTerm:t,conversations:r,folders:a,onDeleteFolder:s,onUpdateFolder:l,selectedConversation:n,loading:i,onSelectConversation:d,onDeleteConversation:c,onUpdateConversation:u}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col pt-2",children:a.map((e,a)=>(0,o.jsx)(es,{searchTerm:t,conversations:r.filter(e=>e.folderId),currentFolder:e,onDeleteFolder:s,onUpdateFolder:l,selectedConversation:n,loading:i,onSelectConversation:d,onDeleteConversation:c,onUpdateConversation:u},a))})},en=e=>{let{placeholder:t,searchTerm:r,onSearch:a}=e,{t:s}=(0,c.$G)("sidebar"),l=e=>{a(e.target.value)},n=()=>{a("")};return(0,o.jsxs)("div",{className:"relative flex items-center",children:[(0,o.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:s(t)||"",value:r,onChange:l}),r&&(0,o.jsx)(i.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:n})]})};var eo=r(51047),ei=r(64738),ed=r(28457);let ec=e=>{let{text:t,icon:r,onClick:a}=e;return(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:a,children:[(0,o.jsx)("div",{children:r}),(0,o.jsx)("span",{children:t})]})};var eu=r(11163),ex=r(59734);let em=e=>{var t;let{lightMode:r,apiKey:a,serverSideApiKeyIsSet:s,pluginKeys:l,serverSidePluginKeysSet:n,conversationsCount:i,onToggleLightMode:d,onApiKeyChange:u,onClearConversations:x,onExportConversations:m,onImportConversations:p,onPluginKeyChange:h,onClearPluginKey:g}=e,{t:f}=(0,c.$G)("sidebar"),v=(0,$.useSession)();(0,eu.useRouter)();let b=async e=>{try{let r=await fetch("/api/stripe-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),a=await r.json();if(r.ok&&a)console.log(a),alert(a.message),(0,$.signOut)();else{var t;console.error("Error creating subscription:",null!==(t=null==a?void 0:a.message)&&void 0!==t?t:r.statusText),alert("Error creating subscription. Please try again later.")}}catch(e){console.error("Error creating subscription:",e),alert("Error creating subscription. Please try again later.")}},y=async()=>{try{let e=confirm("Are you sure you want to delete your membership?");if(!e)return;let t=v.data.user.email,r=await fetch("/api/stripe-delete",{method:"DELETE",body:JSON.stringify({email:t}),headers:{"Content-Type":"application/json"}});if(!r.ok)throw Error("Failed to delete Stripe membership");(0,ex.JG)("/api/auth/session"),alert("Membership deleted. You can renew at any time."),(0,$.signOut)()}catch(e){console.error(e),alert("Failed to delete Stripe membership")}};return(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[(0,o.jsx)(ec,{text:f("light"===r?"Dark mode":"Light mode"),icon:"light"===r?(0,o.jsx)(eo.Z,{size:18}):(0,o.jsx)(ei.Z,{size:18}),onClick:()=>d("light"===r?"dark":"light")}),v.data&&"free"===v.data.user.membership?(0,o.jsx)("div",{className:"w-full",children:(0,o.jsx)(W.Z,{name:"NextChat Plus",description:"USD $20/mo",panelLabel:"Go Plus",email:null!==(t=v.data.user.email)&&void 0!==t?t:"",currency:"USD",locale:"auto",stripeKey:"pk_live_9o7xarrQQSR8yfoIwh5r2uIk00yFNr81db",token:b,children:(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",children:[(0,o.jsx)("div",{children:(0,o.jsx)(S.Z,{size:18})}),(0,o.jsx)("span",{children:"Go Plus"})]})})}):(0,o.jsx)(ec,{text:f("Delete membership"),icon:(0,o.jsx)(S.Z,{size:18}),onClick:()=>y()}),(0,o.jsx)(ec,{text:f("Log out"),icon:(0,o.jsx)(ed.Z,{size:18}),onClick:()=>(0,$.signOut)()})]})},ep=e=>{let{loading:t,conversations:r,selectedConversation:a,onSelectConversation:s,onDeleteConversation:l,onUpdateConversation:n}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:r.slice().reverse().map((e,r)=>(0,o.jsx)(ea,{selectedConversation:a,conversation:e,loading:t,onSelectConversation:s,onDeleteConversation:l,onUpdateConversation:n},r))})},eh=e=>{let{loading:t,conversations:r,lightMode:a,selectedConversation:s,apiKey:l,serverSideApiKeyIsSet:n,pluginKeys:i,serverSidePluginKeysSet:d,folders:x,onCreateFolder:m,onDeleteFolder:p,onUpdateFolder:h,onNewConversation:g,onToggleLightMode:f,onSelectConversation:v,onDeleteConversation:b,onUpdateConversation:y,onApiKeyChange:w,onClearConversations:j,onExportConversations:k,onImportConversations:N,onPluginKeyChange:S,onClearPluginKey:C}=e,{t:I}=(0,c.$G)("sidebar"),[E,P]=(0,u.useState)(""),[O,D]=(0,u.useState)(r),z=(e,t)=>{y(e,t),P("")},Z=e=>{b(e),P("")},T=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));y(t,{key:"folderId",value:0}),e.target.style.background="none"}},L=e=>{e.preventDefault()},_=e=>{e.target.style.background="#343541"},G=e=>{e.target.style.background="none"};return(0,u.useEffect)(()=>{E?D(r.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(E.toLowerCase())})):D(r)},[E,r]),(0,o.jsxs)("div",{className:"fixed top-0 bottom-0 z-50 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 transition-all sm:relative sm:top-0",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"flex w-[190px] flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-[14px] leading-normal text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{g(),P("")},children:[(0,o.jsx)(B.Z,{size:18}),I("New chat")]}),(0,o.jsx)("button",{className:"ml-2 flex flex-shrink-0 cursor-pointer items-center gap-3 rounded-md border border-white/20 p-3 text-[14px] leading-normal text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>m(I("New folder")),children:(0,o.jsx)(q.Z,{size:18})})]}),r.length>1&&(0,o.jsx)(en,{placeholder:"Search conversations...",searchTerm:E,onSearch:P}),(0,o.jsxs)("div",{className:"flex-grow overflow-auto",children:[x.length>0&&(0,o.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:(0,o.jsx)(el,{searchTerm:E,conversations:O.filter(e=>e.folderId),folders:x,onDeleteFolder:p,onUpdateFolder:h,selectedConversation:s,loading:t,onSelectConversation:v,onDeleteConversation:Z,onUpdateConversation:z})}),r.length>0?(0,o.jsx)("div",{className:"pt-2",onDrop:e=>T(e),onDragOver:L,onDragEnter:_,onDragLeave:G,children:(0,o.jsx)(ep,{loading:t,conversations:O.filter(e=>!e.folderId),selectedConversation:s,onSelectConversation:v,onDeleteConversation:Z,onUpdateConversation:z})}):(0,o.jsxs)("div",{className:"mt-8 flex flex-col items-center gap-3 text-sm leading-normal text-white opacity-50",children:[(0,o.jsx)(Q.Z,{}),I("No conversations.")]})]}),(0,o.jsx)(em,{lightMode:a,apiKey:l,serverSideApiKeyIsSet:n,pluginKeys:i,serverSidePluginKeysSet:d,conversationsCount:r.length,onToggleLightMode:f,onApiKeyChange:w,onClearConversations:j,onExportConversations:k,onImportConversations:N,onPluginKeyChange:S,onClearPluginKey:C})]})},eg=e=>{let{selectedConversation:t,onNewConversation:r}=e;return(0,o.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,o.jsx)("div",{className:"mr-4"}),(0,o.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,o.jsx)(B.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:r})]})};var ef=r(92005),ev=r(93844),eb=r(67421),ey=r(12691);let ew=e=>{let{prompt:t,onClose:r,onUpdatePrompt:a}=e,{t:s}=(0,c.$G)("promptbar"),[l,n]=(0,u.useState)(t.name),[i,d]=(0,u.useState)(t.description),[x,m]=(0,u.useState)(t.content),p=(0,u.useRef)(null),h=(0,u.useRef)(null),g=e=>{"Enter"!==e.key||e.shiftKey||(a({...t,name:l,description:i,content:x.trim()}),r())};return(0,u.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),r()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[r]),(0,u.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},[]),(0,o.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-100",onKeyDown:g,children:(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,o.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,o.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,o.jsxs)("div",{ref:p,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-hidden rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"text-sm font-bold text-black dark:text-neutral-200",children:s("Name")}),(0,o.jsx)("input",{ref:h,className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",placeholder:s("A name for your prompt.")||"",value:l,onChange:e=>n(e.target.value)}),(0,o.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:s("Description")}),(0,o.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:s("A description for your prompt.")||"",value:i,onChange:e=>d(e.target.value),rows:3}),(0,o.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:s("Prompt")}),(0,o.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:s("Prompt content. Use {{}} to denote a variable. Ex: {{name}} is a {{adjective}} {{noun}}")||"",value:x,onChange:e=>m(e.target.value),rows:10}),(0,o.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{let e={...t,name:l,description:i,content:x.trim()};a(e),r()},children:s("Save")})]})]})})})},ej=e=>{let{prompt:t,onUpdatePrompt:r,onDeletePrompt:a}=e,[s,l]=(0,u.useState)(!1),[n,d]=(0,u.useState)(!1),[c,x]=(0,u.useState)(!1),[m,p]=(0,u.useState)(""),h=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("prompt",JSON.stringify(t))};return(0,u.useEffect)(()=>{c?d(!1):n&&x(!1)},[c,n]),(0,o.jsxs)("div",{className:"relative flex items-center",children:[(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",draggable:"true",onClick:e=>{e.stopPropagation(),l(!0)},onDragStart:e=>h(e,t),onMouseLeave:()=>{d(!1),x(!1),p("")},children:[(0,o.jsx)(ey.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all pr-4 text-left text-[12.5px] leading-3",children:t.name})]}),(n||c)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),n&&a(t),d(!1)},children:(0,o.jsx)(I.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),d(!1)},children:(0,o.jsx)(i.Z,{size:18})})]}),!n&&!c&&(0,o.jsx)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),d(!0)},children:(0,o.jsx)(et.Z,{size:18})})}),s&&(0,o.jsx)(ew,{prompt:t,onClose:()=>l(!1),onUpdatePrompt:r})]})},ek=e=>{let{searchTerm:t,prompts:r,currentFolder:a,onDeleteFolder:s,onUpdateFolder:l,onDeletePrompt:n,onUpdatePrompt:d}=e,[c,x]=(0,u.useState)(!1),[m,p]=(0,u.useState)(!1),[h,g]=(0,u.useState)(""),[f,v]=(0,u.useState)(!1),b=e=>{"Enter"===e.key&&(e.preventDefault(),y())},y=()=>{l(a.id,h),g(""),p(!1)},w=(e,t)=>{if(e.dataTransfer){v(!0);let r=JSON.parse(e.dataTransfer.getData("prompt")),a={...r,folderId:t.id};d(a),e.target.style.background="none"}},j=e=>{e.preventDefault()},k=e=>{e.target.style.background="#343541"},N=e=>{e.target.style.background="none"};return(0,u.useEffect)(()=>{m?x(!1):c&&p(!1)},[m,c]),(0,u.useEffect)(()=>{t?v(!0):v(!1)},[t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"relative flex items-center",children:[m?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[f?(0,o.jsx)(V.Z,{size:18}):(0,o.jsx)(X.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:h,onChange:e=>g(e.target.value),onKeyDown:b,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>v(!f),onDrop:e=>w(e,a),onDragOver:j,onDragEnter:k,onDragLeave:N,children:[f?(0,o.jsx)(V.Z,{size:18}):(0,o.jsx)(X.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:a.name})]}),(c||m)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),c?s(a.id):m&&y(),x(!1),p(!1)},children:(0,o.jsx)(I.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),x(!1),p(!1)},children:(0,o.jsx)(i.Z,{size:18})})]}),!c&&!m&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),p(!0),g(a.name)},children:(0,o.jsx)(ee.Z,{size:18})}),(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),x(!0)},children:(0,o.jsx)(et.Z,{size:18})})]})]}),f?r.map((e,t)=>{if(e.folderId===a.id)return(0,o.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,o.jsx)(ej,{prompt:e,onDeletePrompt:n,onUpdatePrompt:d})},t)}):null]})},eN=e=>{let{searchTerm:t,prompts:r,folders:a,onDeleteFolder:s,onUpdateFolder:l,onDeletePrompt:n,onUpdatePrompt:i}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col pt-2",children:a.map((e,a)=>(0,o.jsx)(ek,{searchTerm:t,prompts:r.filter(e=>e.folderId),currentFolder:e,onDeleteFolder:s,onUpdateFolder:l,onDeletePrompt:n,onUpdatePrompt:i},a))})},eS=()=>(0,o.jsx)("div",{}),eC=e=>{let{prompts:t,onUpdatePrompt:r,onDeletePrompt:a}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.slice().reverse().map((e,t)=>(0,o.jsx)(ej,{prompt:e,onUpdatePrompt:r,onDeletePrompt:a},t))})},eI=e=>{let{folders:t,prompts:r,onCreateFolder:a,onDeleteFolder:s,onUpdateFolder:l,onCreatePrompt:n,onUpdatePrompt:i,onDeletePrompt:d}=e,{t:c}=(0,eb.$G)("promptbar"),[x,m]=(0,u.useState)(""),[p,h]=(0,u.useState)(r),g=e=>{i(e),m("")},f=e=>{d(e),m("")},v=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("prompt")),r={...t,folderId:e.target.dataset.folderId};i(r),e.target.style.background="none"}},b=e=>{e.preventDefault()},y=e=>{e.target.style.background="#343541"},w=e=>{e.target.style.background="none"};return(0,u.useEffect)(()=>{x?h(r.filter(e=>{let t=e.name.toLowerCase()+" "+e.description.toLowerCase()+" "+e.content.toLowerCase();return t.includes(x.toLowerCase())})):h(r)},[x,r]),(0,o.jsxs)("div",{className:"fixed top-0 right-0 z-50 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"text-sidebar flex w-[190px] flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{n(),m("")},children:[(0,o.jsx)(B.Z,{size:16}),c("New prompt")]}),(0,o.jsx)("button",{className:"flex items-center flex-shrink-0 gap-3 p-3 ml-2 text-sm text-white transition-colors duration-200 border rounded-md cursor-pointer border-white/20 hover:bg-gray-500/10",onClick:()=>a(c("New folder")),children:(0,o.jsx)(q.Z,{size:16})})]}),r.length>1&&(0,o.jsx)(en,{placeholder:c("Search prompts...")||"",searchTerm:x,onSearch:m}),(0,o.jsxs)("div",{className:"flex-grow overflow-auto",children:[t.length>0&&(0,o.jsx)("div",{className:"flex pb-2 border-b border-white/20",children:(0,o.jsx)(eN,{searchTerm:x,prompts:p,folders:t,onUpdateFolder:l,onDeleteFolder:s,onDeletePrompt:f,onUpdatePrompt:g})}),r.length>0?(0,o.jsx)("div",{className:"pt-2",onDrop:e=>v(e),onDragOver:b,onDragEnter:y,onDragLeave:w,children:(0,o.jsx)(eC,{prompts:p.filter(e=>!e.folderId),onUpdatePrompt:g,onDeletePrompt:f})}):(0,o.jsxs)("div",{className:"mt-8 text-center text-white opacity-50 select-none",children:[(0,o.jsx)(ef.Z,{className:"mx-auto mb-3"}),(0,o.jsx)("span",{className:"text-[14px] leading-normal",children:c("No prompts.")})]})]}),(0,o.jsx)("div",{className:"border-t pb-4 mb-2 border-white/20",children:(0,o.jsxs)("a",{href:"/prompts",target:"_blank",className:"text-sidebar flex w-full flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md p-3 text-white transition-colors duration-200 hover:bg-gray-500/10",children:[(0,o.jsx)(ev.Z,{size:16})," Global Prompt Library"]})}),(0,o.jsx)(eS,{})]})};(a=n||(n={})).GPT_3_5="gpt-4-1106-preview",a.GPT_4="gpt-4",n.GPT_3_5;let eE={[n.GPT_3_5]:{id:n.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[n.GPT_4]:{id:n.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3}},eP=e=>e&&e.id===s.GOOGLE_SEARCH?"api/google":"api/chat";var eO=r(83454);let eD=eO.env.DEFAULT_SYSTEM_PROMPT||"You are ChatGPT, a large language model trained by OpenAI. Follow the user's instructions carefully. Respond using markdown.";eO.env.OPENAI_API_HOST;let ez=e=>{let t=e;return t.model||(t={...t,model:t.model||eE[n.GPT_3_5]}),t.prompt||(t={...t,prompt:t.prompt||eD}),t.folderId||(t={...t,folderId:t.folderId||null}),t},eZ=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=eE[n.GPT_3_5]),t.prompt||(t.prompt=eD),t.folderId||(t.folderId=null),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),eT=(e,t)=>{let r=t.map(t=>t.id===e.id?e:t);return eL(e),e_(r),{single:e,all:r}},eL=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},e_=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},eG=e=>{localStorage.setItem("folders",JSON.stringify(e))},eA=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),r=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),r&&(r=JSON.parse(r));let a={version:4,history:e||[],folders:t||[],prompts:r||[]},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(s),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,r=e.getDate();return"".concat(t,"-").concat(r)}(),".json"),n.href=l,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)},eK=e=>{let t=function(e){if(Array.isArray(e))return{version:4,history:eZ(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:eZ(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),{history:r,folders:a,prompts:s}=t;return localStorage.setItem("conversationHistory",JSON.stringify(r)),localStorage.setItem("selectedConversation",JSON.stringify(r[r.length-1])),localStorage.setItem("folders",JSON.stringify(a)),localStorage.setItem("prompts",JSON.stringify(s)),t},eR=e=>{localStorage.setItem("prompts",JSON.stringify(e))};var eF=r(89014),eU=r(98963),eJ=r(9008),eM=r.n(eJ),eH=r(86501),e$=r(57632);let eW=e=>{let{serverSideApiKeyIsSet:t,serverSidePluginKeysSet:r,defaultModelId:a}=e,{t:s}=(0,c.$G)("chat"),l=(0,$.useSession)(),n=(0,eu.useRouter)();(0,u.useEffect)(()=>{"unauthenticated"===l.status&&n.push("/")},[l]);let[i,d]=(0,u.useState)(""),[x,m]=(0,u.useState)([]),[p,h]=(0,u.useState)(!1),[g,f]=(0,u.useState)("light"),[v,b]=(0,u.useState)(!1),[y,w]=(0,u.useState)(null),[j,k]=(0,u.useState)([]),[N,S]=(0,u.useState)([]),[C,I]=(0,u.useState)([]),[E,P]=(0,u.useState)(),[O,D]=(0,u.useState)(),[z,Z]=(0,u.useState)(!0),[T,L]=(0,u.useState)([]),[_,G]=(0,u.useState)(!0),A=(0,u.useRef)(!1),K=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(E){let o,d;if(t){let r=[...E.messages];for(let e=0;e<t;e++)r.pop();o={...E,messages:[...r,e]}}else o={...E,messages:[...E.messages,e]};P(o),h(!0),b(!0);let c={model:o.model,messages:o.messages,key:i,prompt:o.prompt},u=eP(r);if(r){var a,s,l,n;d=JSON.stringify({...c,googleAPIKey:null===(a=null===(s=x.find(e=>"google-search"===e.pluginId))||void 0===s?void 0:s.requiredKeys.find(e=>"GOOGLE_API_KEY"===e.key))||void 0===a?void 0:a.value,googleCSEId:null===(l=null===(n=x.find(e=>"google-search"===e.pluginId))||void 0===n?void 0:n.requiredKeys.find(e=>"GOOGLE_CSE_ID"===e.key))||void 0===l?void 0:l.value})}else d=JSON.stringify(c);let m=new AbortController,p=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},signal:m.signal,body:d});if(!p.ok){h(!1),b(!1),eH.ZP.error(p.statusText);return}let g=p.body;if(!g){h(!1),b(!1);return}if(r){let{answer:e}=await p.json(),t=[...o.messages,{role:"assistant",content:e}];P(o={...o,messages:t}),eL(o);let r=C.map(e=>e.id===E.id?o:e);0===r.length&&r.push(o),I(r),e_(r),h(!1),b(!1)}else{if(1===o.messages.length){let{content:t}=e,r=t.length>30?t.substring(0,30)+"...":t;o={...o,name:r}}h(!1);let t=g.getReader(),r=new TextDecoder,a=!1,s=!0,l="";for(;!a;){if(!0===A.current){m.abort(),a=!0;break}let{value:e,done:n}=await t.read();a=n;let i=r.decode(e);if(l+=i,s){s=!1;let e=[...o.messages,{role:"assistant",content:i}];P(o={...o,messages:e})}else{let e=o.messages.map((e,t)=>t===o.messages.length-1?{...e,content:l}:e);P(o={...o,messages:e})}}eL(o);let n=C.map(e=>e.id===E.id?o:e);0===n.length&&n.push(o),I(n),e_(n),b(!1)}}},R=async e=>{let t={title:s("Error fetching models."),code:null,messageLines:[s("Make sure your payment information is up to date. Click the My Account button in the bottom left of the sidebar."),s("If you completed this step, OpenAI may be experiencing issues.")]},r=await fetch("/api/models",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e})});if(!r.ok){try{var a,l;let e=await r.json();Object.assign(t,{code:null===(a=e.error)||void 0===a?void 0:a.code,messageLines:[null===(l=e.error)||void 0===l?void 0:l.message]})}catch(e){}w(t);return}let n=await r.json();if(!n){w(t);return}k(n),w(null)},F=e=>{f(e),localStorage.setItem("theme",e)},U=e=>{d(e),localStorage.setItem("apiKey",e)},J=e=>{if(x.some(t=>t.pluginId===e.pluginId)){let t=x.map(t=>t.pluginId===e.pluginId?e:t);m(t),localStorage.setItem("pluginKeys",JSON.stringify(t))}else m([...x,e]),localStorage.setItem("pluginKeys",JSON.stringify([...x,e]))},M=e=>{let t=x.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){m([]),localStorage.removeItem("pluginKeys");return}m(t),localStorage.setItem("pluginKeys",JSON.stringify(t))},H=()=>{Z(!z),localStorage.setItem("showChatbar",JSON.stringify(!z))},W=()=>{G(!_),localStorage.setItem("showPromptbar",JSON.stringify(!_))},B=()=>{eA()},q=e=>{let{history:t,folders:r,prompts:a}=eK(e);I(t),P(t[t.length-1]),S(r),L(a)},Q=e=>{P(e),eL(e)},V=(e,t)=>{let r={id:(0,e$.Z)(),name:e,type:t},a=[...N,r];S(a),eG(a)},X=e=>{let t=N.filter(t=>t.id!==e);S(t),eG(t);let r=C.map(t=>t.folderId===e?{...t,folderId:null}:t);I(r),e_(r);let a=T.map(t=>t.folderId===e?{...t,folderId:null}:t);L(a),eR(a)},ee=(e,t)=>{let r=N.map(r=>r.id===e?{...r,name:t}:r);S(r),eG(r)},et=()=>{let e=C[C.length-1],t={id:(0,e$.Z)(),name:"".concat(s("New Conversation")),messages:[],model:(null==e?void 0:e.model)||{id:eE[a].id,name:eE[a].name,maxLength:eE[a].maxLength,tokenLimit:eE[a].tokenLimit},prompt:eD,folderId:null},r=[...C,t];P(t),I(r),eL(t),e_(r),h(!1)},er=e=>{let t=C.filter(t=>t.id!==e.id);I(t),e_(t),t.length>0?(P(t[t.length-1]),eL(t[t.length-1])):(P({id:(0,e$.Z)(),name:"New conversation",messages:[],model:eE[a],prompt:eD,folderId:null}),localStorage.removeItem("selectedConversation"))},ea=(e,t)=>{let r={...e,[t.key]:t.value},{single:a,all:s}=eT(r,C);P(a),I(s)},es=()=>{I([]),localStorage.removeItem("conversationHistory"),P({id:(0,e$.Z)(),name:"New conversation",messages:[],model:eE[a],prompt:eD,folderId:null}),localStorage.removeItem("selectedConversation");let e=N.filter(e=>"chat"!==e.type);S(e),eG(e)},el=(e,t)=>{if(E){let r=E.messages.map((e,r)=>{if(r<t)return e}).filter(e=>e),a={...E,messages:r},{single:s,all:l}=eT(a,C);P(s),I(l),D(e)}},en=()=>{let e={id:(0,e$.Z)(),name:"Prompt ".concat(T.length+1),description:"",content:"",model:eE[a],folderId:null},t=[...T,e];L(t),eR(t)},eo=e=>{let t=T.map(t=>t.id===e.id?e:t);L(t),eR(t)},ei=e=>{let t=T.filter(t=>t.id!==e.id);L(t),eR(t)};return(0,u.useEffect)(()=>{O&&(K(O),D(void 0))},[O]),(0,u.useEffect)(()=>{window.innerWidth<640&&Z(!1)},[E]),(0,u.useEffect)(()=>{i&&R(i)},[i]),(0,u.useEffect)(()=>{let e=localStorage.getItem("theme");e&&f(e);let s=localStorage.getItem("apiKey");t?(R(""),d(""),localStorage.removeItem("apiKey")):s&&(d(s),R(s));let l=localStorage.getItem("pluginKeys");r?(m([]),localStorage.removeItem("pluginKeys")):l&&m(JSON.parse(l)),window.innerWidth<640&&Z(!1);let n=localStorage.getItem("showChatbar");n&&Z("true"===n);let o=localStorage.getItem("showPromptbar");o&&G("true"===o);let i=localStorage.getItem("folders");i&&S(JSON.parse(i));let c=localStorage.getItem("prompts");c&&L(JSON.parse(c));let u=localStorage.getItem("conversationHistory");if(u){let e=JSON.parse(u),t=eZ(e);I(t)}let x=localStorage.getItem("selectedConversation");if(x){let e=JSON.parse(x),t=ez(e);P(t)}else P({id:(0,e$.Z)(),name:"New conversation",messages:[],model:eE[a],prompt:eD,folderId:null})},[t]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(eM(),{children:[(0,o.jsx)("title",{children:"NextChat.ai"}),(0,o.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,o.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),E&&(0,o.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(g),children:[(0,o.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,o.jsx)(eg,{selectedConversation:E,onNewConversation:et})}),(0,o.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[z?(0,o.jsxs)("div",{children:[(0,o.jsx)(eh,{loading:v,conversations:C,lightMode:g,selectedConversation:E,apiKey:i,serverSideApiKeyIsSet:t,pluginKeys:x,serverSidePluginKeysSet:r,folders:N.filter(e=>"chat"===e.type),onToggleLightMode:F,onCreateFolder:e=>V(e,"chat"),onDeleteFolder:X,onUpdateFolder:ee,onNewConversation:et,onSelectConversation:Q,onDeleteConversation:er,onUpdateConversation:ea,onApiKeyChange:U,onClearConversations:es,onExportConversations:B,onImportConversations:q,onPluginKeyChange:J,onClearPluginKey:M}),(0,o.jsx)("button",{className:"fixed top-5 left-[270px] z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:left-[270px] sm:h-8 sm:w-8 sm:text-neutral-700",onClick:H,children:(0,o.jsx)(eF.Z,{})}),(0,o.jsx)("div",{onClick:H,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]}):(0,o.jsx)("button",{className:"fixed top-2.5 left-4 z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:left-4 sm:h-8 sm:w-8 sm:text-neutral-700",onClick:H,children:(0,o.jsx)(eU.Z,{})}),(0,o.jsx)("div",{className:"flex flex-1",children:(0,o.jsx)(Y,{conversation:E,messageIsStreaming:v,apiKey:i,serverSideApiKeyIsSet:t,defaultModelId:a,modelError:y,models:j,loading:p,prompts:T,onSend:K,onUpdateConversation:ea,onEditMessage:el,stopConversationRef:A})}),_?(0,o.jsxs)("div",{children:[(0,o.jsx)(eI,{prompts:T,folders:N.filter(e=>"prompt"===e.type),onCreatePrompt:en,onUpdatePrompt:eo,onDeletePrompt:ei,onCreateFolder:e=>V(e,"prompt"),onDeleteFolder:X,onUpdateFolder:ee}),(0,o.jsx)("button",{className:"fixed top-5 right-[270px] z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:right-[270px] sm:h-8 sm:w-8 sm:text-neutral-700",onClick:W,children:(0,o.jsx)(eU.Z,{})}),(0,o.jsx)("div",{onClick:W,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]}):(0,o.jsx)("button",{className:"fixed top-2.5 right-4 z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:right-4 sm:h-8 sm:w-8 sm:text-neutral-700",onClick:W,children:(0,o.jsx)(eF.Z,{})})]})]})]})};var eY=!0,eB=eW}},function(e){e.O(0,[879,996,928,774,888,179],function(){return e(e.s=80022)}),_N_E=e.O()}]);